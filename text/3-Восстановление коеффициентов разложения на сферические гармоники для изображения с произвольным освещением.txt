Ниже описывается способ представления освещения при помощи сферических гармоник. В данной работе рассматривается диффузная модель освещения при которой яркость точки поверхности можно представить в виде:

<B(p) = ... форм. диффуз осв. > 2.1

где B(p) - отраженный свет, n - нормаль к поверхности в точке p, L(\omega) - oсв.

В [рамамурти_сф_гарм]  описывается подход к анализу изображений трёхмерных объектов, основанный на разложении B(p) на сферические гармоники. Сферические гармоники представляют собой набор функций, формирующих отртонормированный базис для функций заданных на единичной сфере (к каким можно отнести и функцию (2.1)). 

Сферические гармоники Y\sup(lm) задаются в виде:

<формула сф. гармоник> (2.2)

Первые 3 порядка выглядят следующим образом:

<9 формул> (2.3-2.11)

Для анализа освещённости формулы 2.3 - 2.11 можно записать как функции проекций орта нормали:

<9 формул> (2.12-2.20)

В [джанг сф. гарм.] показано, что для разложения освещённости объектов достаточно вышепреведённых первых девяти функций. Таким образом, изображение можно представить в виде: 
<formula I=B'*alpha+E> 2.21
где I - вектор-столбец пикселей изображения размерности d, B - матрица размерности 9*d, где каждая строка соответствует сферической гармонике, \alpha - вектор-столбец коэффициентов разложения размерности 9, E - вектор-столбец размерности d, содержащий невязку между реальным изображением и линейной комбинацией \B'*alpha. При этом вся информация об условиях освещения содержится в векторе \alpha, а матрица B содержит информацию о форме поверхности, которая, очевидно, не зависит от условий освещения и может быть использована в качестве информативных признаков, инвариантных к освещению.

На рис 2.1 показан пример разложения изображения на сферические гармоники.

<рис 2.1>

Далее в части 3 приведён алгоритм восстановления коеффициентов разложения на сферические гармоники для изображения с произвольным освещением, а в части 4 описан способ восстановления базисных изображений. 

------------------------------------ Начало
В этой части описывается алгоритм восстановления коэффициентов разложения изображения произвольного субъекта, взятого с произвольным освещением на сферические гармоники 2.12 - 2.20, основанный на результатах, полученных в [джанг сф. гарм.].

3.1 Вычисление статистических характеристик базисных изображений 

Исходными данными для получения коеффициентов разложения \alpha и базисных изображений для изображения произвольного субъекта, взятого с произвольным освещением являются статистические характеристики разложения 2.21, изученные по предварительно известным 3d моделям лиц. На рис 3.1 приводится схема алгоритма вычисления анализа необходимых данных по набору 3D моделей.

%Рис 3.1%

В начале имеется m 3d моделей.
На первом шаге для каждой 3d модели в анализируемом изображении вычиляются проекции орта нормали (nx, ny, nz), соответствующие пикселам изображений (по d векторов для какждой модели, где d - количество пикселей).
На втором шаге для каждой модели вычилслются 9 базисных изображений по форомулам 2.12-2.20 Blj l=1..m
На третьем шаге вычилсляется оценка математического ожидания для каждого из девяти базисных изображении \\uBj j=1..9 и матрицы ковариации для каждого элемента изображения (d матриц Cb) 
На четвёртом шаге вычисленные на первом шаге нормали используются для генерации изображений IK,I для n различныч условий освещения (всего генерируется n*m различных изображений). 
На пятом шаге для каждого из n условий освещения производится оценка коэффициентов \alphaKj , а также ошибка EKl  k=1..n, l=1..m, j=1..9. Оценка производится методом наименьших квадратов: коэффициенты \alphaKj выбираются таким образом, чтобы при заданном k минимизировать квадрат ошибки \EallK^2 в уравнении \IallK=Ball'*alphaK + Eall, где IallK,  EallK, Ball получаются конкатенацией IKl, EKl, BK для всех субъектов при фиксированном k.
На шестом шаге для каждого из n условий освещения вычисляется среднее значение и дисперсия ошибки \uEKl, \sigmaEKl

Результатом произведённых вычислений являются матрица \uBji, d матриц ковариации Cb, а также для каждого k-ого из n условий освещения \alphaK, \uEK, \sigmaEK, m векторов IK,I.

3.2 Восстановление коеффициентов разложения.

Для восстановления коеффициентов \альфа разложения 2.21 для изображения произвольного субъекта, взятого с произвольным освещением производится аппрок данные, полученные в предыдущем пункте. Оценку коэффициентов \alphaNOVEL для изображения Inovel в формуле 2.21 можно получить методом ядерной регрессии ([zang sph harm]):

\alphaNOVEL_ = \sum(k=1..n|\sum(i=1..m|wki*\alphaK_) ) / \sum(k=1..n|\sum(i=1..m|wki) ) 3.1

где wki = \exp(-1/2*(D(I@k,i@, Inovel)/\sigma@k,i@)^2), D(I1_, I2_) = \sqrt( (I2-I1)^2 ), k - номер предварительно изученного условия освещения , i - номер предварительно изветсной модели, n - количество предварительно изученных условий освещения, m - количество предварительно известных моделей (см. пункт 3.1). Ширина Гауссового ядра, соответствующего изображению k,i, \sigma@k,i@ выбирается таким образом, чтобы приблизительно десятая часть изображений I@k', j'@ соответствовала условию D(I@k,j@_, I@k', j'@) < \sigma@k,i@.

Схожим образом можно получить оценку \uEnovel_ и \sigmaENOVEL^2_:

\uEnovel_ = \sum(k=1..n|\sum(i=1..m|wki*\uEk_) ) / \sum(k=1..n|\sum(i=1..m|wki) ) 3.2

\sigmaENOVEL_ = \sum(k=1..n|\sum(i=1..m|wki*\sigmaENOVELK__) ) / \sum(k=1..n|\sum(i=1..m|wki) ) 3.3

Далее в части 4 описывается алгоритм, позволяющий на основании полученных \alphaNOVEL_, \uEnovel_, \sigmaENOVEL_ оценить BNOVEL_.



